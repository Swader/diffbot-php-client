HTTP/1.1 200 OK
Server: nginx/1.6.2
Date: Sun, 12 Apr 2015 10:19:54 GMT
Content-Type: application/json;charset=utf-8
Transfer-Encoding: chunked
Connection: keep-alive
Vary: Accept-Encoding
Access-Control-Allow-Origin: *

{"request":{"pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","api":"article","version":3,"options":["mentos"]},"objects":[{"tags":[{"id":4585348,"count":9,"prevalence":0.6428571428571428,"label":"Diffbot","type":"organization","uri":"http://dbpedia.org/resource/Diffbot"},{"id":175464,"count":13,"prevalence":0.9285714285714286,"label":"Application programming interface","uri":"http://dbpedia.org/resource/Application_programming_interface"},{"id":1936869,"count":3,"prevalence":0.21428571428571427,"label":"Laravel","type":"Http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#InformationEntity","uri":"http://dbpedia.org/resource/Laravel"},{"id":208652,"count":3,"prevalence":0.21428571428571427,"label":"PHP","type":"Http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#InformationEntity","uri":"http://dbpedia.org/resource/PHP"},{"id":91320,"count":2,"prevalence":0.14285714285714285,"label":"SitePoint","type":"organization","uri":"http://dbpedia.org/resource/SitePoint"}],"icon":"http://www.sitepoint.com/wp-content/themes/sitepoint/assets/images/apple-touch-icon-144x144-precomposed.png","text":"Have you ever wondered how social networks do URL previews so well when you share links? How do they know which images to grab, whom to cite as an author, or which tags to attach to the preview? Is it all crawling with complex regexes over source code? Actually, more often than not, it isn\u2019t. Meta information defined in the source can be unreliable, and sites with less than stellar reputation often use them as keyword carriers, attempting to get search engines to rank them higher. Isn\u2019t what we, the humans, see in front of us what matters anyway?\nIf you want to build a URL preview snippet or a news aggregator, there are many automatic crawlers available online, both proprietary and open source, but you seldom find something as niche as visual machine learning. This is exactly what Diffbot is \u2013 a \u201cvisual learning robot\u201d which renders a URL you request in full and then visually extracts data, helping itself with some metadata from the page source as needed.\nAfter covering some theory, in this post we\u2019ll do a demo API call at one of SitePoint\u2019s posts.\nPHP Library\nThe PHP library for Diffbot is somewhat out of date, and as such we won\u2019t be using it in this demo. We\u2019ll be performing raw API calls, and in some future posts we\u2019ll build our own library for API interaction.\nIf you\u2019d like to take a look at the PHP library nonetheless, see here, and if you\u2019re interested in libraries for other languages, Diffbot has a directory.\nJavaScript Content\nWe said in the introductory section that Diffbot renders the request in full and then analyzes it. But, what about JavaScript content? Nowadays, websites often render some HTML above the fold, and then finish the CSS, JS, and dynamic content loading afterwards. Can the Diffbot API see that?\nAs a matter of fact, yes. Diffbot literally renders the page in full, and then inspects it visually, as explained in my StackOverflow Q&A here. There are some caveats, though, so make sure you read the answer carefully.\nPricing and API Health\nDiffbot has several usage tiers. There\u2019s a free trial tier which kills your API token after 7 days or 10000 calls, whichever comes first. The commercial tokens can be purchased at various prices, and never expire, but do have limitations. A special case by case approach is afforded to open source and/or educational projects which provides an older model of the free token \u2013 10k calls per month, once per second max, but never expires. You need to contact them directly if you think you qualify.\nDiffbot guarantees a high uptime, but failures sometimes do happen \u2013 especially in the most resource intensive API of the bunch: Crawlbot. Crawlbot is used to crawl entire domains, not just individual pages, and as such has a lower reliability rate than other APIs. Not by a lot, but enough to be noticeable in the API Health screen \u2013 the screen you can check to see if an API is up and running or currently unavailable if your calls run into issues or return error 500.\nDemo\nTo prepare your environment, please boot up a Homestead Improved instance.\nCreate Project\nCreate a starter Laravel project by SSHing into the VM with vagrant ssh, going into the Code folder, and executing composer create-project laravel/laravel Laravel --prefer-dist. This will let you access the Laravel greeting page via http://homestead.app:8000 from the host\u2019s browser.\nAdd a Route and Action\nIn app/routes.php add the following route:\n1\nRoute::get('/diffbot', 'HomeController@diffbotDemo');\nIn app/controllers/HomeController add the following action:\n1\n2\n3\npublic function diffbotDemo() {\ndie(\"hi\");\n}\nIf http://homestead.app:8000/diffbot now outputs \u201chi\u201d on the screen, we\u2019re ready to start playing with the API.\nGet a Token\nTo interact with the Diffbot API, you need a token. Sign up for one on their pricing page. For the sake of this demo, let\u2019s call our token $TOKEN, and we\u2019ll refer to it as such in URLs. Replace $TOKEN with your own value where appropriate.\nInstall Guzzle\nWe\u2019ll be using Guzzle as our HTTP client. It\u2019s not required, but I do recommend you get familiar with it through a past article of ours.\nAdd the \"guzzlehttp/guzzle\": \"4.1.*@dev\" to your composer.json so the require block looks like this:\n1\n2\n3\n4\n\"require\": {\n\"laravel/framework\": \"4.2.*\",\n\"guzzlehttp/guzzle\": \"4.1.*@dev\"\n},\nIn the project root, run composer update.\nFetch Article Data\nIn the first example, we\u2019ll crawl a SitePoint post with the default Article API from Diffbot. To do this, we refer to the docs which do an excellent job at explaining the workflow. Change the body of the diffbotDemo action to the following code:\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\npublic function diffbotDemo() {\n$token = \"$TOKEN\";\n$version = 'v3';\n$response = $client->get($version.'/article', ['query' => [\n'token' => $token,\n]]);\ndie(var_dump($response->json()));\n}\nFirst, we set our token. Then, we define a variable that\u2019ll hold the API version. Next, it\u2019s up to us to create a new Guzzle client, and we also give it a base URL so we don\u2019t have to type it in every time we make another request.\nNext up, we create a response object by sending a GET request to the API\u2019s URL, and we add in an array of query parameters in key => value format. In this case, we only pass in the token and the URL, the most basic of parameters.\nFinally, since the Diffbot API returns JSON data, we use Guzzle\u2019s json() method to automatically decode it into an array. We then pretty-print this data:\nAs you can see, we got some information back rather quickly. There\u2019s the icon that was used, a preview of the text, the title, even the language, date and HTML have been returned. You\u2019ll notice there\u2019s no author, however. Let\u2019s change this and request some more values.\nIf we add the \u201cfields\u201d parameter to the query params list and give it a value of \u201ctags\u201d, Diffbot will attempt to extract tags/categories from the URL provided. Add this line to the query array:\n1\n'fields' => 'tags'\nand then change the die part to this:\n1\n2\n$data = $response->json();\ndie(var_dump($data['objects'][0]['tags']));\nRefreshing the screen now gives us this:\nBut, the source code of the article notes several other tags:\nWhy is the result so very different? It\u2019s precisely due to the reason we mentioned at the end of the very first paragraph of this post: what we humans see takes precedence. Diffbot is a visual learning robot, and as such its AI deducts the tags from the actual rendered content \u2013 what it can see \u2013 rather than from looking at the source code which is far too easily spiced up for SEO purposes.\nIs there a way to get the tags from the source code, though, if one really needs them? Furthermore, can we make Diffbot recognize the author on SitePoint articles? Yes. With the Custom API.\nMeta Tags and Author with Custom API\nThe Custom API is a feature which allows you to not only tweak existing Diffbot API to your liking by adding new fields and rules for content extraction, but also allows you to create completely new APIs (accessed via a dedicated URL, too) for custom content processing.\nGo to the dev dashboard and log in with your token. Then, go into \u201cCustom API\u201d. Activate the \u201cCreate a Rule\u201d tab at the bottom, and input the URL of the article we\u2019re crawling into the URL box, then click Test. Your screen should look something like this:\nYou\u2019ll immediately notice the Author field is empty. You can tweak the author-searching rule by clicking Edit next to it, and finding the Author element in the live preview window that opens, then click on it to get the desired result. However, due to some, well, less than perfect CSS on SitePoint\u2019s end, it\u2019s very difficult to provide Diffbot\u2019s API with a consistent path to the author name, especially by clicking on elements. Instead, add the following rule manually: .contributor--large .contributor_name a and click Save.\nYou\u2019ll notice the Preview window now correctly populates the Author field:\nIn fact, this new rule is automatically applied to all SitePoint links for your token. If you try to preview another SitePoint article, like this one, you\u2019ll notice Peter Nijssen is successfully extracted:\nOk, let\u2019s modify the API further. We need the article:tag values that are visible in source code. Doing this requires a two-step process.\nStep 1: Define a Collection\nA collection is exactly what it sounds like \u2013 a collection of values grabbed via a specific ruleset. We\u2019ll call our collection \u201cMetaTags\u201d, and give it the following selector: meta[property=article:tag]. This means \u201cfind all meta elements in the HTML that have the property attribute with the value article:tag\u201c.\nStep 2: Define Collection Fields\nCollection fields are individual entries in a collection \u2013 in our case, the various tags. Click on \u201cAdd a custom field to this collection\u201d, and add the following values:\nClick Save. You\u2019ll immediately have access to the list of Tags in the result window:\n1\ndie(var_dump($data['objects'][0]['metaTags']));\nIf you now refresh the URL we tested with (http://homestead.app:8000/diffbot), you\u2019ll notice the author and meta tags values are there. Here\u2019s the output the above line of code produces:\nWe have our tags!\nConclusion\nDiffbot is a powerful data extractor for the web \u2013 whether you need to consolidate many sites into a single search index without combining their back-ends, want to build a news aggregator, have an idea for a URL preview web component, or want to regularly harvest the contents of competitors\u2019 public pricing lists, Diffbot can help. With dead simple API calls and highly structured responses, you\u2019ll be up and running in next to no time. In a later article, we\u2019ll build a brand new API for using Diffbot with PHP, and redo the calls above with it. We\u2019ll also host the library on Packagist, so you can easily install it with Composer. Stay tuned!","discussion":{"tags":[{"id":78932,"count":2,"prevalence":0.2857142857142857,"label":"HTML","uri":"http://dbpedia.org/resource/HTML"},{"id":91320,"count":1,"prevalence":0.14285714285714285,"label":"SitePoint","type":"organization","uri":"http://dbpedia.org/resource/SitePoint"},{"id":5062,"count":1,"prevalence":0.14285714285714285,"label":"Nice","type":"place","uri":"http://dbpedia.org/resource/Nice"},{"id":491384,"count":1,"prevalence":0.14285714285714285,"label":"IOS","type":"Http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#InformationEntity","uri":"http://dbpedia.org/resource/IOS"},{"id":4585348,"count":1,"prevalence":0.14285714285714285,"label":"Diffbot","type":"organization","uri":"http://dbpedia.org/resource/Diffbot"}],"title":"Diffbot: Crawling with Visual Machine Learning","numPosts":7,"diffbotUri":"discussion|3|-1039854465","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","posts":[{"tags":[{"id":5062,"count":1,"label":"Nice","type":"place","uri":"http://dbpedia.org/resource/Nice"},{"id":4585348,"count":1,"label":"Diffbot","type":"organization","uri":"http://dbpedia.org/resource/Diffbot"},{"id":78932,"count":1,"label":"HTML","uri":"http://dbpedia.org/resource/HTML"}],"id":0,"author":"Peter Nijssen","text":"Nice article! Just wondering; since diffbot is unable to grab the author, can you conclude that it is not actually represented correctly within the website? I mean, you would think that should be an easy field to grab if HTML has been formatted correctly.","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","diffbotUri":"post|3|-2077667749","votes":1,"authorUrl":"https://disqus.com/by/peter_nijssen/","html":"<p>Nice article! Just wondering; since diffbot is unable to grab the author, can you conclude that it is not actually represented correctly within the website? I mean, you would think that should be an easy field to grab if HTML has been formatted correctly.<\/p>","humanLanguage":"en","date":"Sat, 12 Jul 2014 00:00:00 GMT","type":"post"},{"tags":[{"id":91320,"count":1,"label":"SitePoint","type":"organization","uri":"http://dbpedia.org/resource/SitePoint"}],"text":"Correct - there's definitely more that could be done in terms of element declaration in SitePoint's design. Also, notice this: http://www.quora.com/APIs/Are-...","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","votes":0,"humanLanguage":"en","type":"post","date":"Tue, 12 Aug 2014 00:00:00 GMT","id":1,"parentId":0,"author":"Bruno Skvorc","diffbotUri":"post|3|-2083241386","authorUrl":"https://disqus.com/by/brunoskvorc/","html":"<p>Correct - there's definitely more that could be done in terms of element declaration in SitePoint's design. Also, notice this: <a href=\"http://www.quora.com/APIs/Are-there-any-reliable-author-extraction-APIs\">http://www.quora.com/APIs/Are-...<\/a><\/p>"},{"tags":[{"id":491384,"count":1,"label":"IOS","type":"Http://www.ontologydesignpatterns.org/ont/dul/DUL.owl#InformationEntity","uri":"http://dbpedia.org/resource/IOS"},{"id":78932,"count":1,"label":"HTML","uri":"http://dbpedia.org/resource/HTML"}],"id":2,"author":"Stefan Sturm","text":"Great article, but after scraping the article we need to display it somewhere...\nFor me I want to display it on iOS devices.\nDo you know any good libs or HTML templates to use the diffbot text in?\nThanks for your help:)","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","diffbotUri":"post|3|-1634199585","votes":0,"authorUrl":"https://disqus.com/by/stefansturm/","html":"<p>Great article, but after scraping the article we need to display it somewhere...<br>\nFor me I want to display it on iOS devices.<br>\nDo you know any good libs or HTML templates to use the diffbot text in?<\/p>\n<p>Thanks for your help:)<\/p>","humanLanguage":"en","date":"Sun, 12 Oct 2014 00:00:00 GMT","type":"post"},{"id":3,"author":"Taher","text":"Is there any open source projects as good as diffbots?","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","diffbotUri":"post|3|526519145","votes":0,"authorUrl":"https://disqus.com/by/disqus_CWGq6zNflN/","html":"<p>Is there any open source projects as good as diffbots?<\/p>","humanLanguage":"en","date":"Tue, 12 Aug 2014 00:00:00 GMT","type":"post"},{"id":4,"author":"Bruno Skvorc","parentId":3,"text":"The answers here might help you out: https://www.quora.com/Web-Scra...","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","diffbotUri":"post|3|1191295757","votes":1,"authorUrl":"https://disqus.com/by/brunoskvorc/","html":"<p>The answers here might help you out: <a href=\"https://www.quora.com/Web-Scraping/Is-there-any-open-source-web-scraping-tool-such-as-Scrapinghub-or-DiffBot\">https://www.quora.com/Web-Scra...<\/a><\/p>","humanLanguage":"en","date":"Tue, 12 Aug 2014 00:00:00 GMT","type":"post"},{"id":5,"author":"anonymous","text":"i just tried out the demo on diffbots website, and out of 14 pages i feeded it, it could only properly process 3. with most of 'em it was just showing me the copyright notice / legal bla foo embeded in those pages","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","diffbotUri":"post|3|1791110710","votes":0,"html":"<p>i just tried out the demo on diffbots website, and out of 14 pages i feeded it, it could only properly process 3. with most of 'em it was just showing me the copyright notice / legal bla foo embeded in those pages<\/p>","humanLanguage":"en","date":"Tue, 12 Aug 2014 00:00:00 GMT","type":"post"},{"tags":[{"id":175464,"count":1,"label":"Application programming interface","uri":"http://dbpedia.org/resource/Application_programming_interface"}],"text":"That's where custom API comes in to save the day. Out of curiosity, though, which URLs did you try, and which information was missing?","pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","votes":0,"humanLanguage":"en","type":"post","date":"Tue, 12 Aug 2014 00:00:00 GMT","id":6,"parentId":5,"author":"Bruno Skvorc","diffbotUri":"post|3|-1524103211","authorUrl":"https://disqus.com/by/brunoskvorc/","html":"<p>That's where custom API comes in to save the day. Out of curiosity, though, which URLs did you try, and which information was missing?<\/p>"}],"provider":"Disqus","humanLanguage":"en","confidence":1,"numPages":1,"type":"discussion","rssUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/feed/","participants":5},"pageUrl":"http://www.sitepoint.com/diffbot-crawling-visual-machine-learning/","metaTags":[{"name":"ai"},{"name":"Artificial Intelligence"},{"name":"crawling"},{"name":"Diffbot"},{"name":"framework"},{"name":"laravel"},{"name":"machine learning"},{"name":"OOPHP"},{"name":"PHP"},{"name":"scraping"},{"name":"visual learning"}],"humanLanguage":"en","type":"article","date":"Sun, 27 Jul 2014 00:00:00 GMT","author":"Bruno Skvorc","title":"Diffbot: Crawling with Visual Machine Learning","diffbotUri":"article|3|-938093421","images":[{"height":533,"diffbotUri":"image|3|-851701004","naturalHeight":727,"width":780,"primary":true,"naturalWidth":1063,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624455201.png"},{"height":216,"diffbotUri":"image|3|762494522","naturalHeight":216,"width":523,"naturalWidth":523,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624487602.png"},{"height":184,"diffbotUri":"image|3|302236938","naturalHeight":184,"width":664,"naturalWidth":664,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624509003.png"},{"height":784,"diffbotUri":"image|3|-1836356546","naturalHeight":972,"width":780,"naturalWidth":966,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624552704.png"},{"height":156,"diffbotUri":"image|3|1297360030","naturalHeight":184,"width":780,"naturalWidth":918,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624650505.png"},{"height":157,"diffbotUri":"image|3|502449852","naturalHeight":188,"width":780,"naturalWidth":929,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624665606.png"},{"height":175,"diffbotUri":"image|3|-2007985802","naturalHeight":237,"width":780,"naturalWidth":1053,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624803507.png"},{"title":"Change the final output of the  diffbotDemo() action to this:","height":520,"diffbotUri":"image|3|-140134863","naturalHeight":604,"width":780,"naturalWidth":906,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624809508.png"},{"height":533,"diffbotUri":"image|3|1129235416","naturalHeight":727,"width":780,"naturalWidth":1063,"url":"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624834309.png"}],"html":"<p>Have you ever wondered how social networks do URL previews so well when you share links? How do they know which images to grab, whom to cite as an author, or which tags to attach to the preview? Is it all crawling with complex regexes over source code? Actually, more often than not, it isn&rsquo;t. Meta information defined in the source can be unreliable, and sites with less than stellar reputation often use them as keyword carriers, attempting to get search engines to rank them higher. Isn&rsquo;t what we, the humans, see in front of us what matters anyway?<\/p>\n<p>If you want to build a URL preview snippet or a news aggregator, there are many automatic crawlers available online, both proprietary and open source, but you seldom find something as niche as visual machine learning. This is exactly what <a href=\"http://diffbot.com\">Diffbot<\/a> is &ndash; a &ldquo;visual learning robot&rdquo; which renders a URL you request in full and then visually extracts data, helping itself with some metadata from the page source as needed.<\/p>\n<p>After covering some theory, in this post we&rsquo;ll do a demo API call at one of SitePoint&rsquo;s posts.<\/p>\n<h2>PHP Library<\/h2>\n<p>The PHP library for Diffbot is somewhat out of date, and as such we won&rsquo;t be using it in this demo. We&rsquo;ll be performing raw API calls, and in some future posts we&rsquo;ll build our own library for API interaction.<\/p>\n<p>If you&rsquo;d like to take a look at the PHP library nonetheless, see <a href=\"https://github.com/diffbot/diffbot-php-client\">here<\/a>, and if you&rsquo;re interested in libraries for other languages, Diffbot has a <a href=\"https://diffbot.com/dev/docs/libraries/\">directory<\/a>.<\/p>\n<h2>JavaScript Content<\/h2>\n<p>We said in the introductory section that Diffbot renders the request in full and then analyzes it. But, what about JavaScript content? Nowadays, websites often render some HTML above the fold, and then finish the CSS, JS, and dynamic content loading afterwards. Can the Diffbot API see that?<\/p>\n<p>As a matter of fact, yes. Diffbot literally renders the page in full, and then inspects it visually, as explained in my StackOverflow Q&amp;A <a href=\"http://stackoverflow.com/questions/24915127/does-diffbot-execute-javascript/24915128#24915128\">here<\/a>. There are some caveats, though, so make sure you read the answer carefully.<\/p>\n<h2>Pricing and API Health<\/h2>\n<p>Diffbot has several usage tiers. There&rsquo;s a free trial tier which kills your API token after 7 days or 10000 calls, whichever comes first. The commercial tokens can be purchased at <a href=\"http://diffbot.com/pricing\">various prices<\/a>, and never expire, but do have limitations. A special case by case approach is afforded to open source and/or educational projects which provides an older model of the free token &ndash; 10k calls per month, once per second max, but never expires. You need to contact them directly if you think you qualify.<\/p>\n<p>Diffbot guarantees a high uptime, but failures sometimes do happen &ndash; especially in the most resource intensive API of the bunch: Crawlbot. Crawlbot is used to crawl entire domains, not just individual pages, and as such has a lower reliability rate than other APIs. Not by a lot, but enough to be noticeable in the <a href=\"http://status.diffbot.com/\">API Health<\/a> screen &ndash; the screen you can check to see if an API is up and running or currently unavailable if your calls run into issues or return error 500.<\/p>\n<h2>Demo<\/h2>\n<p>To prepare your environment, please boot up a <a href=\"http://www.sitepoint.com/quick-tip-get-homestead-vagrant-vm-running/\">Homestead Improved<\/a> instance.<\/p>\n<h3>Create Project<\/h3>\n<p>Create a starter Laravel project by SSHing into the VM with <code>vagrant ssh<\/code>, going into the <code>Code<\/code> folder, and executing <code>composer create-project laravel/laravel Laravel --prefer-dist<\/code>. This will let you access the Laravel greeting page via <code>http://homestead.app:8000<\/code> from the host&rsquo;s browser.<\/p>\n<h3>Add a Route and Action<\/h3>\n<p>In <code>app/routes.php<\/code> add the following route:<\/p>\n<table><tbody><tr><td>1<\/td><td><code>Route::get(<\/code><code>'/diffbot'<\/code><code>, <\/code><code>'HomeController@diffbotDemo'<\/code><code>);<\/code><\/td><\/tr><\/tbody><\/table>\n<p>In <code>app/controllers/HomeController<\/code> add the following action:<\/p>\n<table><tbody><tr><td>123<\/td><td><code>public<\/code> <code>function<\/code> <code>diffbotDemo() {<\/code><code>die<\/code><code>(<\/code><code>&quot;hi&quot;<\/code><code>);<\/code><code>}<\/code><\/td><\/tr><\/tbody><\/table>\n<p>If <code>http://homestead.app:8000/diffbot<\/code> now outputs &ldquo;hi&rdquo; on the screen, we&rsquo;re ready to start playing with the API.<\/p>\n<h3>Get a Token<\/h3>\n<p>To interact with the Diffbot API, you need a token. Sign up for one on <a href=\"http://diffbot.com/pricing/\">their pricing page<\/a>. For the sake of this demo, let&rsquo;s call our token <code>$TOKEN<\/code>, and we&rsquo;ll refer to it as such in URLs. Replace <code>$TOKEN<\/code> with your own value where appropriate.<\/p>\n<h3>Install Guzzle<\/h3>\n<p>We&rsquo;ll be using Guzzle as our HTTP client. It&rsquo;s not required, but I do recommend you get familiar with it through a <a href=\"http://www.sitepoint.com/guzzle-php-http-client/\">past article of ours<\/a>.<\/p>\n<p>Add the <code>&quot;guzzlehttp/guzzle&quot;: &quot;4.1.*@dev&quot;<\/code> to your <code>composer.json<\/code> so the require block looks like this:<\/p>\n<table><tbody><tr><td>1234<\/td><td><code>&quot;require&quot;: {<\/code><code>&quot;laravel/framework&quot;: &quot;4.2.*&quot;,<\/code><code>&quot;guzzlehttp/guzzle&quot;: &quot;4.1.*@dev&quot;<\/code><code>},<\/code><\/td><\/tr><\/tbody><\/table>\n<p>In the project root, run <code>composer update<\/code>.<\/p>\n<h3>Fetch Article Data<\/h3>\n<p>In the first example, we&rsquo;ll crawl a SitePoint post with the default Article API from Diffbot. To do this, we refer to <a href=\"https://diffbot.com/dev/docs/\">the docs<\/a> which do an excellent job at explaining the workflow. Change the body of the <code>diffbotDemo<\/code> action to the following code:<\/p>\n<table><tbody><tr><td>1234567891011121314<\/td><td><code>public<\/code> <code>function<\/code> <code>diffbotDemo() {<\/code><code>$token<\/code> <code>= <\/code><code>&quot;$TOKEN&quot;<\/code><code>;<\/code><code>$version<\/code> <code>= <\/code><code>'v3'<\/code><code>;<\/code><code>$response<\/code> <code>= <\/code><code>$client<\/code><code>-&gt;get(<\/code><code>$version<\/code><code>.<\/code><code>'/article'<\/code><code>, [<\/code><code>'query'<\/code> <code>=&gt; [<\/code><code>'token'<\/code> <code>=&gt; <\/code><code>$token<\/code><code>,<\/code><code>]]);<\/code><code>die<\/code><code>(var_dump(<\/code><code>$response<\/code><code>-&gt;json()));<\/code><code>}<\/code><\/td><\/tr><\/tbody><\/table>\n<p>First, we set our token. Then, we define a variable that&rsquo;ll hold the API version. Next, it&rsquo;s up to us to create a new Guzzle client, and we also give it a base URL so we don&rsquo;t have to type it in every time we make another request.<\/p>\n<p>Next up, we create a response object by sending a GET request to the API&rsquo;s URL, and we add in an array of query parameters in key =&gt; value format. In this case, we only pass in the token and the URL, the most basic of parameters.<\/p>\n<p>Finally, since the Diffbot API returns JSON data, we use Guzzle&rsquo;s <code>json()<\/code> method to automatically decode it into an array. We then pretty-print this data:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624455201.png\"><\/img><\/figure>\n<p>As you can see, we got some information back rather quickly. There&rsquo;s the icon that was used, a preview of the text, the title, even the language, date and HTML have been returned. You&rsquo;ll notice there&rsquo;s no author, however. Let&rsquo;s change this and request some more values.<\/p>\n<p>If we add the &ldquo;fields&rdquo; parameter to the query params list and give it a value of &ldquo;tags&rdquo;, Diffbot will attempt to extract tags/categories from the URL provided. Add this line to the <code>query<\/code> array:<\/p>\n<table><tbody><tr><td>1<\/td><td><code>'fields'<\/code> <code>=&gt; <\/code><code>'tags'<\/code><\/td><\/tr><\/tbody><\/table>\n<p>and then change the <code>die<\/code> part to this:<\/p>\n<table><tbody><tr><td>12<\/td><td><code>$data<\/code> <code>= <\/code><code>$response<\/code><code>-&gt;json();<\/code><code>die<\/code><code>(var_dump(<\/code><code>$data<\/code><code>[<\/code><code>'objects'<\/code><code>][0][<\/code><code>'tags'<\/code><code>]));<\/code><\/td><\/tr><\/tbody><\/table>\n<p>Refreshing the screen now gives us this:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624487602.png\"><\/img><\/figure>\n<p>But, the source code of the article notes several other tags:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624509003.png\"><\/img><\/figure>\n<p>Why is the result so very different? It&rsquo;s precisely due to the reason we mentioned at the end of the very first paragraph of this post: what we humans see takes precedence. Diffbot is a visual learning robot, and as such its AI deducts the tags from the actual rendered content &ndash; what it can see &ndash; rather than from looking at the source code which is far too easily spiced up for SEO purposes.<\/p>\n<p>Is there a way to get the tags from the source code, though, if one really needs them? Furthermore, can we make Diffbot recognize the author on SitePoint articles? Yes. With the Custom API.<\/p>\n<h3>Meta Tags and Author with Custom API<\/h3>\n<p>The Custom API is a feature which allows you to not only tweak existing Diffbot API to your liking by adding new fields and rules for content extraction, but also allows you to create completely new APIs (accessed via a dedicated URL, too) for custom content processing.<\/p>\n<p>Go to the <a href=\"http://diffbot.com/dev\">dev dashboard<\/a> and log in with your token. Then, go into &ldquo;Custom API&rdquo;. Activate the &ldquo;Create a Rule&rdquo; tab at the bottom, and input the URL of the article we&rsquo;re crawling into the URL box, then click Test. Your screen should look something like this:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624552704.png\"><\/img><\/figure>\n<p>You&rsquo;ll immediately notice the Author field is empty. You can tweak the author-searching rule by clicking Edit next to it, and finding the Author element in the live preview window that opens, then click on it to get the desired result. However, due to some, well, less than perfect CSS on SitePoint&rsquo;s end, it&rsquo;s very difficult to provide Diffbot&rsquo;s API with a consistent path to the author name, especially by clicking on elements. Instead, add the following rule manually: <code>.contributor--large .contributor_name a<\/code> and click Save.<\/p>\n<p>You&rsquo;ll notice the Preview window now correctly populates the Author field:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624650505.png\"><\/img><\/figure>\n<p>In fact, this new rule is automatically applied to all SitePoint links for your token. If you try to preview another SitePoint article, like <a href=\"http://www.sitepoint.com/social-network-authentication-twitter-facebook/\">this one<\/a>, you&rsquo;ll notice Peter Nijssen is successfully extracted:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624665606.png\"><\/img><\/figure>\n<p>Ok, let&rsquo;s modify the API further. We need the <code>article:tag<\/code> values that are visible in source code. Doing this requires a two-step process.<\/p>\n<h4>Step 1: Define a Collection<\/h4>\n<p>A collection is exactly what it sounds like &ndash; a collection of values grabbed via a specific ruleset. We&rsquo;ll call our collection &ldquo;MetaTags&rdquo;, and give it the following selector: <code>meta[property=article:tag]<\/code>. This means &ldquo;find all meta elements in the HTML that have the <code>property<\/code> attribute with the value <code>article:tag<\/code>&ldquo;.<\/p>\n<h4>Step 2: Define Collection Fields<\/h4>\n<p>Collection fields are individual entries in a collection &ndash; in our case, the various tags. Click on &ldquo;Add a custom field to this collection&rdquo;, and add the following values:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624803507.png\"><\/img><\/figure>\n<p>Click Save. You&rsquo;ll immediately have access to the list of Tags in the result window:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624809508.png\"><\/img><figcaption>Change the final output of the diffbotDemo() action to this:<\/figcaption><\/figure>\n<table><tbody><tr><td>1<\/td><td><code>die<\/code><code>(var_dump(<\/code><code>$data<\/code><code>[<\/code><code>'objects'<\/code><code>][0][<\/code><code>'metaTags'<\/code><code>]));<\/code><\/td><\/tr><\/tbody><\/table>\n<p>If you now refresh the URL we tested with (<code>http://homestead.app:8000/diffbot<\/code>), you&rsquo;ll notice the author and meta tags values are there. Here&rsquo;s the output the above line of code produces:<\/p>\n<figure><img alt=\"\" src=\"http://dab1nmslvvntp.cloudfront.net/wp-content/uploads/2014/07/140624834309.png\"><\/img><\/figure>\n<p>We have our tags!<\/p>\n<h2>Conclusion<\/h2>\n<p>Diffbot is a powerful data extractor for the web &ndash; whether you need to consolidate many sites into a single search index without combining their back-ends, want to build a news aggregator, have an idea for a URL preview web component, or want to regularly harvest the contents of competitors&rsquo; public pricing lists, Diffbot can help. With dead simple API calls and highly structured responses, you&rsquo;ll be up and running in next to no time. In a later article, we&rsquo;ll build a brand new API for using Diffbot with PHP, and redo the calls above with it. We&rsquo;ll also host the library on Packagist, so you can easily install it with Composer. Stay tuned!<\/p>"}]}